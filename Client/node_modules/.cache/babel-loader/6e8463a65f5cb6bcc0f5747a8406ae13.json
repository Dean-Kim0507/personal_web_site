{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import{Button,FormGroup,Label,Input}from'reactstrap';import{Image}from'react-bootstrap';import ImageUploader from\"react-images-upload\";import{useHistory}from\"react-router-dom\";import{useDispatch,useSelector}from\"react-redux\";import{UNAUTHORIZED}from\"../type\";import{SET_MESSAGE}from\"../../Actions/types\";import'../../css/UpdateBlogList.css';function UpdateBlogList(props){var _useSelector=useSelector(function(state){return state.auth;}),isLoggedIn=_useSelector.isLoggedIn,user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.message;}),message=_useSelector2.message;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),pictures=_useState2[0],setPictures=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),imgUploader=_useState4[0],setImgUploader=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),imgButton=_useState6[0],setImgButton=_useState6[1];var dispatch=useDispatch();var onDrop=function onDrop(picture){setPictures([].concat(_toConsumableArray(pictures),[picture]));};var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),retrievedData=_useState8[0],setRetrievedData=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),title=_useState10[0],setTitle=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),writer=_useState12[0],setWriter=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),id=_useState14[0],setId=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),desc=_useState16[0],setDesc=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),userID=_useState18[0],setUserID=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),isLogedIn=_useState20[0],setIsLogedIn=_useState20[1];var formData=new FormData();var IMG_WIDTH=45;var IMG_LENGTH=50;var temp_data;var info={id:props.match.params.id,writer:props.match.params.author};var history=useHistory();var splittedImagePaths=[];var _uploadResult='';var errNum;var errPage;// useEffect(() => {\n// \tif (message == UNAUTHORIZED) {\n// \t\tdispatch({\n// \t\t\ttype: SET_MESSAGE,\n// \t\t\tpayload: null,\n// \t\t});\n// \t\thistory.push('/login');\n// \t}\n// }, [message])\nuseEffect(function(){axios.post(\"/blog/retrieveblog\",info).then(function(response){temp_data=response.data;if(temp_data.imagespath!=null){splittedImagePaths=temp_data.imagespath.split(',');for(var a=0;a<splittedImagePaths.length;a++){splittedImagePaths[a]=splittedImagePaths[a].substring(16,splittedImagePaths[a].length);}temp_data.imagespath=splittedImagePaths;}setRetrievedData(temp_data);setWriter(temp_data.writer);setId(temp_data.blog_id);setDesc(temp_data.description);setTitle(temp_data.title);setIsLogedIn(temp_data.isLogedIn);setUserID(temp_data.userID);}).then(function(){if(isLogedIn){if(user!=null){if(user.userID!=userID){history.push('/bloglist');}}else{history.push('/bloglist');}}});},[]);var showImgUploader=function showImgUploader(){setImgUploader(true);setImgButton(false);};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();formData.append('id',retrievedData.blog_id);formData.append('writer',e.target.writer.value);formData.append('title',e.target.title.value);formData.append('desc',e.target.desc.value);//The case, user update Image in blog\nif(pictures.length>0){for(i=0;i<pictures[pictures.length-1].length;i++){formData.append('images',pictures[pictures.length-1][i]);}formData.append('mode','update_images');}//The case, user update without image\nelse if(pictures.length===0&&imgUploader){formData.append('mode','update_nonImages');}// The case, user just want to update text info\nelse formData.append('mode','update_text');console.log(formData);_context.next=9;return axios.post(\"/blog/update\",formData).then(function(response){console.log(response);_uploadResult=response.data;if(_uploadResult==='Update success')history.push('/bloglist');else{console.log(response.data.original.errno);errNum=response.data.original.errno;errPage='UpdateBlogList.js';history.push(\"/errorpage/\".concat(errNum,\"/\").concat(errPage));}}).catch(function(error){console.log(error);errNum='101';errPage='UpdateBlogList.js';history.push(\"/errorpage/\".concat(errNum,\"/\").concat(errPage));console.log(error);});case 9:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref.apply(this,arguments);};}();function handleChange(_x2){return _handleChange.apply(this,arguments);}function _handleChange(){_handleChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var targetName;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:targetName=event.target.name;if(targetName==='title')setTitle(event.target.value);else if(targetName==='writer')setWriter(event.target.value);else if(targetName==='desc')setDesc(event.target.value);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return _handleChange.apply(this,arguments);}return/*#__PURE__*/React.createElement(\"div\",{className:\"updateBlogList_whole\"},/*#__PURE__*/React.createElement(\"form\",{action:\"\",method:\"post\",encType:\"multipart/form-data\",onSubmit:onSubmit},/*#__PURE__*/React.createElement(\"h2\",null,\"Update Blog\"),retrievedData&&/*#__PURE__*/React.createElement(React.Fragment,null,console.log('return: '+retrievedData.title),console.log('return: '+temp_data),isLogedIn?/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Image,{src:user.profileImg,width:IMG_WIDTH,height:IMG_LENGTH,alt:\"45x50\",roundedCircle:true}),/*#__PURE__*/React.createElement(\"label\",null,/*#__PURE__*/React.createElement(\"h3\",null,userID)),/*#__PURE__*/React.createElement(Input,{type:\"text\",name:\"writer\",value:userID,hidden:true})):/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Label,{for:\"writer\"},\"Writer\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",name:\"writer\",placeholder:\"NAME\",value:writer,onChange:handleChange})),/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Label,{for:\"title\"},\"Title\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",name:\"title\",placeholder:\"TITLE\",value:title,onChange:handleChange})),/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Label,{for:\"desc\"},\"Text Area\"),/*#__PURE__*/React.createElement(Input,{type:\"textarea\",name:\"desc\",placeholder:\"TEXT\",value:desc,onChange:handleChange,style:{height:'200px'}}))),imgButton?/*#__PURE__*/React.createElement(Button,{variant:\"secondary\",onClick:showImgUploader,size:\"md\",block:true,className:\"updatedBlogList_updateImage\"},\"Update Image\"):null,imgUploader?/*#__PURE__*/React.createElement(ImageUploader,Object.assign({name:\"imageUploader\"},props,{withIcon:true,onChange:onDrop,imgExtension:[\".jpg\",\".gif\",\".png\",\".gif\"],maxFileSize:5242880,withPreview:true})):null,/*#__PURE__*/React.createElement(Button,{color:\"primary\",type:\"submit\",className:\"updateBlogList_submitButton\"},\"Submit\")));}export default UpdateBlogList;","map":{"version":3,"sources":["C:/Users/834043/Desktop/study/Personal_Web_Site/client/src/Components/BlogComponents/UpdateBlogList.jsx"],"names":["React","useState","useEffect","axios","Button","FormGroup","Label","Input","Image","ImageUploader","useHistory","useDispatch","useSelector","UNAUTHORIZED","SET_MESSAGE","UpdateBlogList","props","state","auth","isLoggedIn","user","message","pictures","setPictures","imgUploader","setImgUploader","imgButton","setImgButton","dispatch","onDrop","picture","retrievedData","setRetrievedData","title","setTitle","writer","setWriter","id","setId","desc","setDesc","userID","setUserID","isLogedIn","setIsLogedIn","formData","FormData","IMG_WIDTH","IMG_LENGTH","temp_data","info","match","params","author","history","splittedImagePaths","_uploadResult","errNum","errPage","post","then","response","data","imagespath","split","a","length","substring","blog_id","description","push","showImgUploader","onSubmit","e","preventDefault","append","target","value","i","console","log","original","errno","catch","error","handleChange","event","targetName","name","profileImg","height"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Button, FormGroup, Label, Input } from 'reactstrap';\r\nimport { Image } from 'react-bootstrap';\r\nimport ImageUploader from \"react-images-upload\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n\tUNAUTHORIZED\r\n} from \"../type\";\r\nimport {\r\n\tSET_MESSAGE\r\n} from \"../../Actions/types\";\r\nimport '../../css/UpdateBlogList.css';\r\n\r\nfunction UpdateBlogList(props) {\r\n\tconst { isLoggedIn, user } = useSelector(state => state.auth);\r\n\tconst { message } = useSelector(state => state.message);\r\n\tconst [pictures, setPictures] = useState([]);\r\n\tconst [imgUploader, setImgUploader] = useState(false);\r\n\tconst [imgButton, setImgButton] = useState(true);\r\n\tconst dispatch = useDispatch();\r\n\tconst onDrop = picture => {\r\n\t\tsetPictures([...pictures, picture]);\r\n\t};\r\n\tconst [retrievedData, setRetrievedData] = useState(null);\r\n\tconst [title, setTitle] = useState(null);\r\n\tconst [writer, setWriter] = useState(null);\r\n\tconst [id, setId] = useState(null);\r\n\tconst [desc, setDesc] = useState(null);\r\n\tconst [userID, setUserID] = useState(null);\r\n\tconst [isLogedIn, setIsLogedIn] = useState(null);\r\n\tconst formData = new FormData();\r\n\tconst IMG_WIDTH = 45;\r\n\tconst IMG_LENGTH = 50;\r\n\tlet temp_data;\r\n\tlet info =\r\n\t{\r\n\t\tid: props.match.params.id,\r\n\t\twriter: props.match.params.author\r\n\t}\r\n\tlet history = useHistory();\r\n\tlet splittedImagePaths = [];\r\n\tlet _uploadResult = '';\r\n\tlet errNum;\r\n\tlet errPage;\r\n\r\n\t// useEffect(() => {\r\n\t// \tif (message == UNAUTHORIZED) {\r\n\t// \t\tdispatch({\r\n\t// \t\t\ttype: SET_MESSAGE,\r\n\t// \t\t\tpayload: null,\r\n\t// \t\t});\r\n\t// \t\thistory.push('/login');\r\n\t// \t}\r\n\t// }, [message])\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\taxios.post(\"/blog/retrieveblog\", info)\r\n\t\t\t.then(response => {\r\n\t\t\t\ttemp_data = response.data;\r\n\t\t\t\tif (temp_data.imagespath != null) {\r\n\t\t\t\t\tsplittedImagePaths = temp_data.imagespath.split(',');\r\n\t\t\t\t\tfor (let a = 0; a < splittedImagePaths.length; a++) {\r\n\t\t\t\t\t\tsplittedImagePaths[a] = splittedImagePaths[a].substring(16, splittedImagePaths[a].length);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemp_data.imagespath = splittedImagePaths;\r\n\t\t\t\t}\r\n\t\t\t\tsetRetrievedData(temp_data);\r\n\t\t\t\tsetWriter(temp_data.writer);\r\n\t\t\t\tsetId(temp_data.blog_id);\r\n\t\t\t\tsetDesc(temp_data.description);\r\n\t\t\t\tsetTitle(temp_data.title);\r\n\t\t\t\tsetIsLogedIn(temp_data.isLogedIn);\r\n\t\t\t\tsetUserID(temp_data.userID);\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (isLogedIn) {\r\n\t\t\t\t\tif (user != null) {\r\n\t\t\t\t\t\tif (user.userID != userID) {\r\n\t\t\t\t\t\t\thistory.push('/bloglist');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\thistory.push('/bloglist');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}, [])\r\n\r\n\tconst showImgUploader = () => {\r\n\t\tsetImgUploader(true);\r\n\t\tsetImgButton(false);\r\n\t}\r\n\r\n\tconst onSubmit = async (e) => {\r\n\t\te.preventDefault();\r\n\t\tformData.append('id', retrievedData.blog_id)\r\n\t\tformData.append('writer', e.target.writer.value);\r\n\t\tformData.append('title', e.target.title.value);\r\n\t\tformData.append('desc', e.target.desc.value);\r\n\t\t//The case, user update Image in blog\r\n\t\tif (pictures.length > 0) {\r\n\t\t\tfor (let i = 0; i < pictures[pictures.length - 1].length; i++) {\r\n\t\t\t\tformData.append('images', pictures[pictures.length - 1][i]);\r\n\t\t\t}\r\n\t\t\tformData.append('mode', 'update_images');\r\n\t\t}\r\n\t\t//The case, user update without image\r\n\t\telse if (pictures.length === 0 && imgUploader) {\r\n\t\t\tformData.append('mode', 'update_nonImages');\r\n\t\t}\r\n\t\t// The case, user just want to update text info\r\n\t\telse formData.append('mode', 'update_text');\r\n\r\n\t\tconsole.log(formData);\r\n\t\tawait axios.post(\"/blog/update\", formData)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => {\r\n\t\t\t\t\tconsole.log(response)\r\n\t\t\t\t\t_uploadResult = response.data;\r\n\t\t\t\t\tif (_uploadResult === 'Update success') history.push('/bloglist');\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tconsole.log(response.data.original.errno)\r\n\t\t\t\t\t\terrNum = response.data.original.errno;\r\n\t\t\t\t\t\terrPage = 'UpdateBlogList.js'\r\n\t\t\t\t\t\thistory.push(`/errorpage/${errNum}/${errPage}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t.catch(function (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\terrNum = '101';\r\n\t\t\t\terrPage = 'UpdateBlogList.js'\r\n\t\t\t\thistory.push(`/errorpage/${errNum}/${errPage}`);\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t});\r\n\r\n\t}\r\n\r\n\tasync function handleChange(event) {\r\n\r\n\t\tlet targetName = event.target.name;\r\n\t\tif (targetName === 'title') setTitle(event.target.value);\r\n\t\telse if (targetName === 'writer') setWriter(event.target.value);\r\n\t\telse if (targetName === 'desc') setDesc(event.target.value);\r\n\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className='updateBlogList_whole'>\r\n\t\t\t<form action='' method=\"post\" encType=\"multipart/form-data\"\r\n\t\t\t\tonSubmit={onSubmit}>\r\n\t\t\t\t<h2>Update Blog</h2>\r\n\t\t\t\t{\r\n\t\t\t\t\tretrievedData &&\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t{console.log('return: ' + retrievedData.title)}\r\n\t\t\t\t\t\t{console.log('return: ' + temp_data)}\r\n\t\t\t\t\t\t{isLogedIn ?\r\n\t\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t\t<Image src={user.profileImg}\r\n\t\t\t\t\t\t\t\t\twidth={IMG_WIDTH}\r\n\t\t\t\t\t\t\t\t\theight={IMG_LENGTH}\r\n\t\t\t\t\t\t\t\t\talt=\"45x50\"\r\n\t\t\t\t\t\t\t\t\troundedCircle />\r\n\t\t\t\t\t\t\t\t<label><h3>{userID}</h3></label>\r\n\t\t\t\t\t\t\t\t<Input type=\"text\" name=\"writer\" value={userID} hidden />\r\n\t\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t\t\t: <FormGroup>\r\n\t\t\t\t\t\t\t\t<Label for=\"writer\">Writer</Label>\r\n\t\t\t\t\t\t\t\t<Input type=\"text\" name=\"writer\" placeholder=\"NAME\" value={writer} onChange={handleChange} />\r\n\t\t\t\t\t\t\t</FormGroup>\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t<Label for=\"title\">Title</Label>\r\n\t\t\t\t\t\t\t<Input type=\"text\" name=\"title\" placeholder=\"TITLE\" value={title} onChange={handleChange} />\r\n\t\t\t\t\t\t</FormGroup>\r\n\r\n\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t<Label for=\"desc\">Text Area</Label>\r\n\t\t\t\t\t\t\t<Input type=\"textarea\" name=\"desc\" placeholder=\"TEXT\" value={desc} onChange={handleChange} style={{ height: '200px' }} />\r\n\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\t{\r\n\t\t\t\t\timgButton ?\r\n\t\t\t\t\t\t<Button variant=\"secondary\" onClick={showImgUploader} size=\"md\" block className=\"updatedBlogList_updateImage\">\r\n\t\t\t\t\t\t\tUpdate Image\r\n  \t\t\t\t\t</Button>\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t\t{\r\n\t\t\t\t\timgUploader ?\r\n\t\t\t\t\t\t<ImageUploader\r\n\t\t\t\t\t\t\tname=\"imageUploader\"\r\n\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\twithIcon={true}\r\n\t\t\t\t\t\t\tonChange={onDrop}\r\n\t\t\t\t\t\t\timgExtension={[\".jpg\", \".gif\", \".png\", \".gif\"]}\r\n\t\t\t\t\t\t\tmaxFileSize={5242880}\r\n\t\t\t\t\t\t\twithPreview={true}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t\t<Button color=\"primary\" type=\"submit\" className=\"updateBlogList_submitButton\">Submit</Button>\r\n\t\t\t</form>\r\n\t\t</div >\r\n\r\n\t);\r\n}\r\n\r\n\r\n\r\nexport default UpdateBlogList;"]},"metadata":{},"sourceType":"module"}