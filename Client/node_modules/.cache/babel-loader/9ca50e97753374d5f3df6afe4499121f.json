{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\client\\\\src\\\\Components\\\\CommunityComponents\\\\CommunityPost.jsx\";\nimport React, { Component } from 'react';\nimport TOC from \"./Components/TOC\";\nimport ReadContent from \"./Components/ReadContent\";\nimport Subject from \"./Components/Subject\";\nimport Control from \"./Components/Control\";\nimport UpdateContent from \"./Components/UpdateContent\";\nimport CreateContent from './Components/CreateContent';\nimport axios from 'axios';\nimport { Button, Row, Col } from 'react-bootstrap';\nimport '../../css/CommunityPost.css';\nimport CommunityNav from './CommunityNav';\n\nconst format = require('date-format'); // Use class\n\n\nclass CommunityPost extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mode: 'list',\n      selected_content_id: 0,\n      contents: [],\n      type: props.match.params.type,\n      subject: \"Community Post\",\n      subtitle: \"This is the area of OPEN POST! Please feel free to leave anything you want to share with us. Have a fun!\"\n    };\n  } // receive data by using fetch\n\n\n  componentDidMount() {\n    console.log(this.props);\n\n    if (this.state.type === 'feedbackpost') {\n      this.setState({\n        subject: \"Feed Back Post\",\n        subtitle: \"Feel free to leave any feed back for this web page!\"\n      });\n    }\n\n    axios.post('/communitypost/senddata', {\n      type: this.state.type\n    }).then(response => {\n      this.setState(() => ({\n        contents: response.data.data\n      })); // console.log('data: ', response.data);\n    });\n  } // receive data by using axios (don't need to convert)\n\n\n  async setData(_id, _writer, _title, _desc, _mode) {\n    console.log('setData()');\n    let data = {\n      id: _id,\n      writer: _writer,\n      title: _title,\n      desc: _desc,\n      mode: _mode,\n      type: this.state.type\n    };\n    await axios.post('/communitypost/receivedata', data).then(response => {\n      console.log(response.data);\n      this.setState(() => ({\n        contents: response.data.data\n      }));\n    }) // {this.setState({contents: response.data.rows[1]})})\n    .catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  getReadContent() {\n    let i = 0;\n\n    while (i < this.state.contents.length) {\n      let data = this.state.contents[i];\n\n      if (data.id === this.state.selected_content_id) {\n        return data;\n      }\n\n      i = i + 1;\n    }\n  }\n\n  getContent() {\n    let _article,\n        _content = null;\n\n    if (this.state.mode === 'list') {\n      _article = /*#__PURE__*/React.createElement(TOC, {\n        onChangePage: async function (id) {\n          await this.setState({\n            mode: 'read',\n            selected_content_id: Number(id)\n          });\n        }.bind(this),\n        data: this.state.contents,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 15\n        }\n      });\n      return _article;\n    } //read\n    else if (this.state.mode === 'read') {\n        _content = this.getReadContent();\n        let date;\n\n        if (_content.createdAt === _content.updatedAt) {\n          date = format.asString('hh:mm, MM-dd-yyyy', new Date(_content.createdAt));\n        } else date = format.asString('hh:mm, MM-dd-yyyy', new Date(_content.updatedAt)) + ' (Edited)';\n\n        _article = /*#__PURE__*/React.createElement(ReadContent, {\n          id: _content.id,\n          writer: _content.writer,\n          title: _content.title,\n          desc: _content.desc,\n          date: date,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 15\n          }\n        });\n      } // Update\n      else if (this.state.mode === 'update') {\n          _content = this.getReadContent();\n          _article = /*#__PURE__*/React.createElement(UpdateContent, {\n            data: _content,\n            onSubmit: function (_id, _writer, _title, _desc) {\n              //add content to this.state.cotnents\n              this.setData(_id, _writer, _title, _desc, 'update');\n              this.setState({\n                mode: 'read'\n              });\n            }.bind(this),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 15\n            }\n          });\n        } //create\n        else if (this.state.mode === 'create') {\n            _article = /*#__PURE__*/React.createElement(CreateContent, {\n              onSubmit: async function (_writer, _title, _desc) {\n                //add content to this.state.cotnents\n                await this.setData(0, _writer, _title, _desc, 'create');\n                await this.setState({\n                  selected_content_id: this.state.contents[this.state.contents.length - 1].id,\n                  mode: 'read'\n                });\n              }.bind(this),\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 121,\n                columnNumber: 15\n              }\n            });\n          }\n\n    return _article;\n  }\n\n  createController() {\n    let _button;\n\n    if (this.state.mode === 'read') {\n      console.log('createController()');\n      _button = /*#__PURE__*/React.createElement(Control, {\n        onChangeMode: function (_mode) {\n          //delete\n          if (_mode === 'delete') {\n            if (window.confirm('Are you sure to delete this post?')) {\n              console.log(this.state.selected_content_id);\n              this.setData(this.state.selected_content_id, '', '', '', 'delete');\n              this.setState({\n                mode: 'list',\n                selected_content_id: 0\n              });\n              alert('Delete Success!');\n            }\n          } else {\n            this.setState({\n              mode: _mode\n            });\n          }\n        }.bind(this),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 14\n        }\n      });\n      return _button;\n    } else {\n      return null;\n    }\n  }\n\n  createPost() {\n    let _post;\n\n    if (this.state.mode !== 'create' && this.state.mode !== 'update') {\n      _post = /*#__PURE__*/React.createElement(Button, {\n        variant: \"primary\",\n        onClick: function (e) {\n          e.preventDefault();\n          this.setState({\n            mode: 'create'\n          });\n        }.bind(this),\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 12\n        }\n      }, \"Add New Post\");\n      return _post;\n    } else return null;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"CommunityPost\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      fluid: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      xs: 2,\n      id: \"sidebar-wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(CommunityNav, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      xs: 10,\n      id: \"page-content-wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Subject, {\n      title: this.state.subject,\n      sub: this.state.subtitle,\n      onChangePage: function () {\n        this.setState({\n          mode: 'list'\n        });\n      }.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 8\n      }\n    }), this.getContent(), this.createController(), this.createPost()))));\n  }\n\n}\n\nexport default CommunityPost;","map":{"version":3,"sources":["C:/Users/834043/Desktop/study/Personal_Web_Site/client/src/Components/CommunityComponents/CommunityPost.jsx"],"names":["React","Component","TOC","ReadContent","Subject","Control","UpdateContent","CreateContent","axios","Button","Row","Col","CommunityNav","format","require","CommunityPost","constructor","props","state","mode","selected_content_id","contents","type","match","params","subject","subtitle","componentDidMount","console","log","setState","post","then","response","data","setData","_id","_writer","_title","_desc","_mode","id","writer","title","desc","catch","error","getReadContent","i","length","getContent","_article","_content","Number","bind","date","createdAt","updatedAt","asString","Date","createController","_button","window","confirm","alert","createPost","_post","e","preventDefault","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport TOC from \"./Components/TOC\";\r\nimport ReadContent from \"./Components/ReadContent\";\r\nimport Subject from \"./Components/Subject\";\r\nimport Control from \"./Components/Control\";\r\nimport UpdateContent from \"./Components/UpdateContent\";\r\nimport CreateContent from './Components/CreateContent';\r\nimport axios from 'axios';\r\nimport { Button, Row, Col } from 'react-bootstrap';\r\nimport '../../css/CommunityPost.css'\r\nimport CommunityNav from './CommunityNav';\r\nconst format = require('date-format');\r\n\r\n// Use class\r\nclass CommunityPost extends Component {\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tmode: 'list',\r\n\t\t\tselected_content_id: 0,\r\n\t\t\tcontents: [],\r\n\t\t\ttype: props.match.params.type,\r\n\t\t\tsubject: \"Community Post\",\r\n\t\t\tsubtitle: \"This is the area of OPEN POST! Please feel free to leave anything you want to share with us. Have a fun!\"\r\n\t\t}\r\n\t}\r\n\t// receive data by using fetch\r\n\tcomponentDidMount() {\r\n\t\tconsole.log(this.props);\r\n\r\n\t\tif (this.state.type === 'feedbackpost') {\r\n\t\t\tthis.setState({\r\n\t\t\t\tsubject: \"Feed Back Post\",\r\n\t\t\t\tsubtitle: \"Feel free to leave any feed back for this web page!\"\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\taxios.post('/communitypost/senddata', { type: this.state.type })\r\n\t\t\t.then(response => {\r\n\t\t\t\tthis.setState(() => ({ contents: response.data.data }))\r\n\t\t\t\t// console.log('data: ', response.data);\r\n\t\t\t})\r\n\t}\r\n\r\n\t// receive data by using axios (don't need to convert)\r\n\tasync setData(_id, _writer, _title, _desc, _mode) {\r\n\t\tconsole.log('setData()');\r\n\t\tlet data = {\r\n\t\t\tid: _id,\r\n\t\t\twriter: _writer,\r\n\t\t\ttitle: _title,\r\n\t\t\tdesc: _desc,\r\n\t\t\tmode: _mode,\r\n\t\t\ttype: this.state.type\r\n\t\t}\r\n\r\n\t\tawait axios.post('/communitypost/receivedata', data)\r\n\t\t\t.then(response => {\r\n\t\t\t\tconsole.log(response.data)\r\n\t\t\t\tthis.setState(() => ({ contents: response.data.data }))\r\n\t\t\t})\r\n\t\t\t// {this.setState({contents: response.data.rows[1]})})\r\n\t\t\t.catch(function (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetReadContent() {\r\n\t\tlet i = 0;\r\n\t\twhile (i < this.state.contents.length) {\r\n\t\t\tlet data = this.state.contents[i];\r\n\t\t\tif (data.id === this.state.selected_content_id) {\r\n\t\t\t\treturn data;\r\n\t\t\t}\r\n\t\t\ti = i + 1;\r\n\t\t}\r\n\t}\r\n\r\n\tgetContent() {\r\n\t\tlet _article, _content = null;\r\n\t\tif (this.state.mode === 'list') {\r\n\t\t\t_article = <TOC onChangePage={\r\n\t\t\t\tasync function (id) {\r\n\t\t\t\t\tawait this.setState({\r\n\t\t\t\t\t\tmode: 'read',\r\n\t\t\t\t\t\tselected_content_id: Number(id)\r\n\t\t\t\t\t});\r\n\t\t\t\t}.bind(this)\r\n\t\t\t} data={this.state.contents}></TOC>\r\n\t\t\treturn _article\r\n\t\t}\r\n\r\n\t\t//read\r\n\t\telse if (this.state.mode === 'read') {\r\n\t\t\t_content = this.getReadContent();\r\n\t\t\tlet date;\r\n\t\t\tif (_content.createdAt === _content.updatedAt) {\r\n\t\t\t\tdate = format.asString('hh:mm, MM-dd-yyyy', new Date(_content.createdAt));\r\n\t\t\t} else date = format.asString('hh:mm, MM-dd-yyyy', new Date(_content.updatedAt)) + ' (Edited)';\r\n\t\t\t_article = <ReadContent id={_content.id} writer={_content.writer} title={_content.title} desc={_content.desc} date={date} ></ReadContent>\r\n\t\t}\r\n\r\n\t\t// Update\r\n\t\telse if (this.state.mode === 'update') {\r\n\t\t\t_content = this.getReadContent();\r\n\t\t\t_article = <UpdateContent data={_content} onSubmit={\r\n\t\t\t\tfunction (_id, _writer, _title, _desc) {\r\n\t\t\t\t\t//add content to this.state.cotnents\r\n\t\t\t\t\tthis.setData(_id, _writer, _title, _desc, 'update');\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\tmode: 'read'\r\n\t\t\t\t\t});\r\n\t\t\t\t}.bind(this)\r\n\t\t\t}></UpdateContent>\r\n\r\n\t\t}\r\n\r\n\t\t//create\r\n\t\telse if (this.state.mode === 'create') {\r\n\t\t\t_article = <CreateContent onSubmit={\r\n\t\t\t\tasync function (_writer, _title, _desc) {\r\n\t\t\t\t\t//add content to this.state.cotnents\r\n\t\t\t\t\tawait this.setData(0, _writer, _title, _desc, 'create');\r\n\t\t\t\t\tawait this.setState({\r\n\t\t\t\t\t\tselected_content_id: this.state.contents[this.state.contents.length - 1].id,\r\n\t\t\t\t\t\tmode: 'read'\r\n\t\t\t\t\t});\r\n\t\t\t\t}.bind(this)\r\n\t\t\t}></CreateContent>\r\n\t\t}\r\n\t\treturn _article;\r\n\t}\r\n\r\n\tcreateController() {\r\n\t\tlet _button;\r\n\t\tif (this.state.mode === 'read') {\r\n\t\t\tconsole.log('createController()');\r\n\t\t\t_button = <Control onChangeMode={function (_mode) {\r\n\t\t\t\t//delete\r\n\t\t\t\tif (_mode === 'delete') {\r\n\t\t\t\t\tif (window.confirm('Are you sure to delete this post?')) {\r\n\t\t\t\t\t\tconsole.log(this.state.selected_content_id);\r\n\t\t\t\t\t\tthis.setData(this.state.selected_content_id, '', '', '', 'delete');\r\n\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\tmode: 'list',\r\n\t\t\t\t\t\t\tselected_content_id: 0\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\talert('Delete Success!');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\tmode: _mode\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}.bind(this)}></Control>\r\n\t\t\treturn _button;\r\n\t\t}\r\n\t\telse { return null; }\r\n\t}\r\n\r\n\tcreatePost() {\r\n\t\tlet _post;\r\n\t\tif (this.state.mode !== 'create' && this.state.mode !== 'update') {\r\n\t\t\t_post = <Button variant=\"primary\" onClick={function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.setState({ mode: 'create' })\r\n\t\t\t}.bind(this)} type=\"button\">Add New Post</Button>\r\n\r\n\t\t\treturn _post;\r\n\t\t}\r\n\t\telse return null;\r\n\t}\r\n\r\n\trender() {\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"CommunityPost\">\r\n\t\t\t\t<Container fluid>\r\n\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t<Col xs={2} id=\"sidebar-wrapper\">\r\n\t\t\t\t\t\t\t<CommunityNav />\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t<Col xs={10} id=\"page-content-wrapper\">\r\n\t\t\t\t\t\t\t<Subject\r\n\t\t\t\t\t\t\t\ttitle={this.state.subject}\r\n\t\t\t\t\t\t\t\tsub={this.state.subtitle}\r\n\t\t\t\t\t\t\t\tonChangePage={function () {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ mode: 'list' });\r\n\r\n\t\t\t\t\t\t\t\t}.bind(this)}\r\n\t\t\t\t\t\t\t></Subject>\r\n\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t{this.getContent()}\r\n\r\n\t\t\t\t\t\t\t{this.createController()}\r\n\r\n\t\t\t\t\t\t\t{this.createPost()}\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t</Container>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n\r\nexport default CommunityPost;"]},"metadata":{},"sourceType":"module"}