{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\834043\\\\Desktop\\\\study\\\\Personal_Web_Site\\\\Client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";// import { user } from \"../../../server/mysql\";\nimport authHeader from\"./Auth.header\";import{RESET_PASSWORD,USER_UPDATE,WRONG_PASSWORD,USER_UPDATE_SUCCESS,DELETE_ACCOUNT,DELETE_ACCOUNT_SUCCESS,UNAUTHORIZED}from\"../Components/type\";import{SET_MESSAGE}from\"../Actions/types\";import{useDispatch,useSelector}from\"react-redux\";var formData;//if registration success, return \"Registration success\"\nvar register=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user_data,imgFile){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(user_data,imgFile);formData=new FormData();formData.append('userID',user_data.userID);formData.append('password',user_data.password);formData.append('firstName',user_data.firstName);formData.append('lastName',user_data.lastName);formData.append('email',user_data.email);formData.append('imgFile',imgFile);// for (var pair of formData.entries()) { console.log(pair[0] + ', ' + pair[1]); }\n_context.next=10;return axios.post(\"/registration\",formData,{headers:{'Content-Type':'multipart/form-data'}});case 10:return _context.abrupt(\"return\",_context.sent);case 11:case\"end\":return _context.stop();}}},_callee);}));return function register(_x,_x2){return _ref.apply(this,arguments);};}();var login=function login(userID,password){var basicProfileImgPath=\"./uploadImages/icon/img_user.jpg\";var login_Data={userID:userID,password:password};return axios.post(\"/login\",login_Data).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(response.data.accessToken){//Setting up the image path \nif(response.data.profileImg!=null){response.data.profileImg=response.data.profileImg.substring(16,response.data.profileImg.length);}else response.data.profileImg=basicProfileImgPath;localStorage.setItem(\"user\",JSON.stringify(response.data));}return _context2.abrupt(\"return\",response.data);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref2.apply(this,arguments);};}());};var logout=function logout(){localStorage.removeItem(\"user\");};var userUpdate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(user_data,imgFile){var basicProfileImgPath;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:basicProfileImgPath=\"./uploadImages/icon/img_user.jpg\";formData=new FormData();if(user_data.type===USER_UPDATE){formData.append('userID',user_data.userID);formData.append('firstName',user_data.firstName);formData.append('lastName',user_data.lastName);formData.append('email',user_data.email);formData.append('type',user_data.type);formData.append('imgFile',imgFile);}else if(user_data.type===RESET_PASSWORD){formData.append('userID',user_data.userID);formData.append('currentPassword',user_data.currentPassword);formData.append('newPassword',user_data.newPassword);formData.append('type',user_data.type);}else if(user_data.type===DELETE_ACCOUNT){formData.append('userID',user_data.userID);formData.append('password',user_data.password);formData.append('type',user_data.type);}_context4.next=5;return axios.post(\"/userupdate\",formData,{headers:authHeader()}).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(response.data.message==USER_UPDATE_SUCCESS)){_context3.next=8;break;}if(!response.data.accessToken){_context3.next=6;break;}if(response.data.profileImg!=null){response.data.profileImg=response.data.profileImg.substring(16,response.data.profileImg.length);}else{response.data.profileImg=basicProfileImgPath;}localStorage.removeItem(\"user\");localStorage.setItem(\"user\",JSON.stringify(response.data));return _context3.abrupt(\"return\",response.data);case 6:_context3.next=9;break;case 8:return _context3.abrupt(\"return\",response.data);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref4.apply(this,arguments);};}());case 5:return _context4.abrupt(\"return\",_context4.sent);case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function userUpdate(_x4,_x5){return _ref3.apply(this,arguments);};}();var loginValid=function loginValid(){return axios.get(\"/isloggedin\",{headers:authHeader()});};export default{register:register,login:login,logout:logout,userUpdate:userUpdate,loginValid:loginValid};","map":{"version":3,"sources":["C:/Users/834043/Desktop/study/Personal_Web_Site/client/src/Services/Auth.service.jsx"],"names":["axios","authHeader","RESET_PASSWORD","USER_UPDATE","WRONG_PASSWORD","USER_UPDATE_SUCCESS","DELETE_ACCOUNT","DELETE_ACCOUNT_SUCCESS","UNAUTHORIZED","SET_MESSAGE","useDispatch","useSelector","formData","register","user_data","imgFile","console","log","FormData","append","userID","password","firstName","lastName","email","post","headers","login","basicProfileImgPath","login_Data","then","response","data","accessToken","profileImg","substring","length","localStorage","setItem","JSON","stringify","logout","removeItem","userUpdate","type","currentPassword","newPassword","message","loginValid","get"],"mappings":"6WAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA;AACA,MAAOC,CAAAA,UAAP,KAAuB,eAAvB,CACA,OACCC,cADD,CAECC,WAFD,CAGCC,cAHD,CAICC,mBAJD,CAKCC,cALD,CAMCC,sBAND,CAOCC,YAPD,KAQO,oBARP,CASA,OACCC,WADD,KAEO,kBAFP,CAGA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,GAAIC,CAAAA,QAAJ,CAEA;AACA,GAAMC,CAAAA,QAAQ,0FAAG,iBAAOC,SAAP,CAAkBC,OAAlB,kHAChBC,OAAO,CAACC,GAAR,CAAYH,SAAZ,CAAuBC,OAAvB,EACAH,QAAQ,CAAG,GAAIM,CAAAA,QAAJ,EAAX,CACAN,QAAQ,CAACO,MAAT,CAAgB,QAAhB,CAA0BL,SAAS,CAACM,MAApC,EACAR,QAAQ,CAACO,MAAT,CAAgB,UAAhB,CAA4BL,SAAS,CAACO,QAAtC,EACAT,QAAQ,CAACO,MAAT,CAAgB,WAAhB,CAA6BL,SAAS,CAACQ,SAAvC,EACAV,QAAQ,CAACO,MAAT,CAAgB,UAAhB,CAA4BL,SAAS,CAACS,QAAtC,EACAX,QAAQ,CAACO,MAAT,CAAgB,OAAhB,CAAyBL,SAAS,CAACU,KAAnC,EACAZ,QAAQ,CAACO,MAAT,CAAgB,SAAhB,CAA2BJ,OAA3B,EACA;AATgB,uBAUHf,CAAAA,KAAK,CAACyB,IAAN,CAAW,eAAX,CAA4Bb,QAA5B,CACV,CACDc,OAAO,CAAE,CAAE,eAAgB,qBAAlB,CADR,CADU,CAVG,+GAAH,kBAARb,CAAAA,QAAQ,gDAAd,CAiBA,GAAMc,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACP,MAAD,CAASC,QAAT,CAAsB,CACnC,GAAMO,CAAAA,mBAAmB,CAAG,kCAA5B,CACA,GAAMC,CAAAA,UAAU,CAAG,CAClBT,MAAM,CAAEA,MADU,CAElBC,QAAQ,CAAEA,QAFQ,CAAnB,CAIA,MAAOrB,CAAAA,KAAK,CAACyB,IAAN,CAAW,QAAX,CAAqBI,UAArB,EACLC,IADK,2FACA,kBAAOC,QAAP,sHACL,GAAIA,QAAQ,CAACC,IAAT,CAAcC,WAAlB,CAA+B,CAC9B;AACA,GAAIF,QAAQ,CAACC,IAAT,CAAcE,UAAd,EAA4B,IAAhC,CAAsC,CACrCH,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAA2BH,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAAyBC,SAAzB,CAAmC,EAAnC,CAAuCJ,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAAyBE,MAAhE,CAA3B,CACA,CAFD,IAGKL,CAAAA,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAA2BN,mBAA3B,CACLS,YAAY,CAACC,OAAb,CAAqB,MAArB,CAA6BC,IAAI,CAACC,SAAL,CAAeT,QAAQ,CAACC,IAAxB,CAA7B,EACA,CARI,iCASED,QAAQ,CAACC,IATX,0DADA,iEAAP,CAYA,CAlBD,CAoBA,GAAMS,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACpBJ,YAAY,CAACK,UAAb,CAAwB,MAAxB,EACA,CAFD,CAIA,GAAMC,CAAAA,UAAU,2FAAG,kBAAO7B,SAAP,CAAkBC,OAAlB,8IACZa,mBADY,CACU,kCADV,CAElBhB,QAAQ,CAAG,GAAIM,CAAAA,QAAJ,EAAX,CACA,GAAIJ,SAAS,CAAC8B,IAAV,GAAmBzC,WAAvB,CAAoC,CACnCS,QAAQ,CAACO,MAAT,CAAgB,QAAhB,CAA0BL,SAAS,CAACM,MAApC,EACAR,QAAQ,CAACO,MAAT,CAAgB,WAAhB,CAA6BL,SAAS,CAACQ,SAAvC,EACAV,QAAQ,CAACO,MAAT,CAAgB,UAAhB,CAA4BL,SAAS,CAACS,QAAtC,EACAX,QAAQ,CAACO,MAAT,CAAgB,OAAhB,CAAyBL,SAAS,CAACU,KAAnC,EACAZ,QAAQ,CAACO,MAAT,CAAgB,MAAhB,CAAwBL,SAAS,CAAC8B,IAAlC,EACAhC,QAAQ,CAACO,MAAT,CAAgB,SAAhB,CAA2BJ,OAA3B,EACA,CAPD,IAQK,IAAID,SAAS,CAAC8B,IAAV,GAAmB1C,cAAvB,CAAuC,CAC3CU,QAAQ,CAACO,MAAT,CAAgB,QAAhB,CAA0BL,SAAS,CAACM,MAApC,EACAR,QAAQ,CAACO,MAAT,CAAgB,iBAAhB,CAAmCL,SAAS,CAAC+B,eAA7C,EACAjC,QAAQ,CAACO,MAAT,CAAgB,aAAhB,CAA+BL,SAAS,CAACgC,WAAzC,EACAlC,QAAQ,CAACO,MAAT,CAAgB,MAAhB,CAAwBL,SAAS,CAAC8B,IAAlC,EACA,CALI,IAMA,IAAI9B,SAAS,CAAC8B,IAAV,GAAmBtC,cAAvB,CAAuC,CAC3CM,QAAQ,CAACO,MAAT,CAAgB,QAAhB,CAA0BL,SAAS,CAACM,MAApC,EACAR,QAAQ,CAACO,MAAT,CAAgB,UAAhB,CAA4BL,SAAS,CAACO,QAAtC,EACAT,QAAQ,CAACO,MAAT,CAAgB,MAAhB,CAAwBL,SAAS,CAAC8B,IAAlC,EACA,CArBiB,uBAsBL5C,CAAAA,KAAK,CAACyB,IAAN,CAAW,aAAX,CAA0Bb,QAA1B,CACV,CACDc,OAAO,CAAEzB,UAAU,EADlB,CADU,EAKX6B,IALW,2FAKN,kBAAOC,QAAP,2HACDA,QAAQ,CAACC,IAAT,CAAce,OAAd,EAAyB1C,mBADxB,+BAEA0B,QAAQ,CAACC,IAAT,CAAcC,WAFd,0BAGH,GAAIF,QAAQ,CAACC,IAAT,CAAcE,UAAd,EAA4B,IAAhC,CAAsC,CACrCH,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAA2BH,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAAyBC,SAAzB,CAAmC,EAAnC,CAAuCJ,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAAyBE,MAAhE,CAA3B,CACA,CAFD,IAGK,CAAEL,QAAQ,CAACC,IAAT,CAAcE,UAAd,CAA2BN,mBAA3B,CAAiD,CACxDS,YAAY,CAACK,UAAb,CAAwB,MAAxB,EACAL,YAAY,CAACC,OAAb,CAAqB,MAArB,CAA6BC,IAAI,CAACC,SAAL,CAAeT,QAAQ,CAACC,IAAxB,CAA7B,EARG,iCASID,QAAQ,CAACC,IATb,wEAYOD,QAAQ,CAACC,IAZhB,0DALM,iEAtBK,iHAAH,kBAAVW,CAAAA,UAAU,kDAAhB,CA2CA,GAAMK,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACxB,MAAOhD,CAAAA,KAAK,CAACiD,GAAN,CAAU,aAAV,CAAyB,CAAEvB,OAAO,CAAEzB,UAAU,EAArB,CAAzB,CAAP,CACA,CAFD,CAIA,cAAe,CACdY,QAAQ,CAARA,QADc,CAEdc,KAAK,CAALA,KAFc,CAGdc,MAAM,CAANA,MAHc,CAIdE,UAAU,CAAVA,UAJc,CAKdK,UAAU,CAAVA,UALc,CAAf","sourcesContent":["import axios from \"axios\";\r\n// import { user } from \"../../../server/mysql\";\r\nimport authHeader from \"./Auth.header\";\r\nimport {\r\n\tRESET_PASSWORD,\r\n\tUSER_UPDATE,\r\n\tWRONG_PASSWORD,\r\n\tUSER_UPDATE_SUCCESS,\r\n\tDELETE_ACCOUNT,\r\n\tDELETE_ACCOUNT_SUCCESS,\r\n\tUNAUTHORIZED\r\n} from \"../Components/type\";\r\nimport {\r\n\tSET_MESSAGE\r\n} from \"../Actions/types\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nlet formData;\r\n\r\n//if registration success, return \"Registration success\"\r\nconst register = async (user_data, imgFile) => {\r\n\tconsole.log(user_data, imgFile)\r\n\tformData = new FormData();\r\n\tformData.append('userID', user_data.userID);\r\n\tformData.append('password', user_data.password);\r\n\tformData.append('firstName', user_data.firstName);\r\n\tformData.append('lastName', user_data.lastName);\r\n\tformData.append('email', user_data.email);\r\n\tformData.append('imgFile', imgFile);\r\n\t// for (var pair of formData.entries()) { console.log(pair[0] + ', ' + pair[1]); }\r\n\treturn await axios.post(\"/registration\", formData\r\n\t\t, {\r\n\t\t\theaders: { 'Content-Type': 'multipart/form-data' }\r\n\t\t}\r\n\t)\r\n}\r\n\r\nconst login = (userID, password) => {\r\n\tconst basicProfileImgPath = \"./uploadImages/icon/img_user.jpg\";\r\n\tconst login_Data = {\r\n\t\tuserID: userID,\r\n\t\tpassword: password\r\n\t}\r\n\treturn axios.post(\"/login\", login_Data)\r\n\t\t.then(async (response) => {\r\n\t\t\tif (response.data.accessToken) {\r\n\t\t\t\t//Setting up the image path \r\n\t\t\t\tif (response.data.profileImg != null) {\r\n\t\t\t\t\tresponse.data.profileImg = response.data.profileImg.substring(16, response.data.profileImg.length);\r\n\t\t\t\t}\r\n\t\t\t\telse response.data.profileImg = basicProfileImgPath;\r\n\t\t\t\tlocalStorage.setItem(\"user\", JSON.stringify(response.data));\r\n\t\t\t}\r\n\t\t\treturn response.data;\r\n\t\t});\r\n};\r\n\r\nconst logout = () => {\r\n\tlocalStorage.removeItem(\"user\");\r\n};\r\n\r\nconst userUpdate = async (user_data, imgFile) => {\r\n\tconst basicProfileImgPath = \"./uploadImages/icon/img_user.jpg\";\r\n\tformData = new FormData();\r\n\tif (user_data.type === USER_UPDATE) {\r\n\t\tformData.append('userID', user_data.userID);\r\n\t\tformData.append('firstName', user_data.firstName);\r\n\t\tformData.append('lastName', user_data.lastName);\r\n\t\tformData.append('email', user_data.email);\r\n\t\tformData.append('type', user_data.type);\r\n\t\tformData.append('imgFile', imgFile);\r\n\t}\r\n\telse if (user_data.type === RESET_PASSWORD) {\r\n\t\tformData.append('userID', user_data.userID);\r\n\t\tformData.append('currentPassword', user_data.currentPassword);\r\n\t\tformData.append('newPassword', user_data.newPassword);\r\n\t\tformData.append('type', user_data.type);\r\n\t}\r\n\telse if (user_data.type === DELETE_ACCOUNT) {\r\n\t\tformData.append('userID', user_data.userID);\r\n\t\tformData.append('password', user_data.password);\r\n\t\tformData.append('type', user_data.type);\r\n\t}\r\n\treturn await axios.post(\"/userupdate\", formData\r\n\t\t, {\r\n\t\t\theaders: authHeader()\r\n\t\t}\r\n\t)\r\n\t\t.then(async (response) => {\r\n\t\t\tif (response.data.message == USER_UPDATE_SUCCESS) {\r\n\t\t\t\tif (response.data.accessToken) {\r\n\t\t\t\t\tif (response.data.profileImg != null) {\r\n\t\t\t\t\t\tresponse.data.profileImg = response.data.profileImg.substring(16, response.data.profileImg.length);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse { response.data.profileImg = basicProfileImgPath; }\r\n\t\t\t\t\tlocalStorage.removeItem(\"user\");\r\n\t\t\t\t\tlocalStorage.setItem(\"user\", JSON.stringify(response.data));\r\n\t\t\t\t\treturn response.data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse return response.data;\r\n\t\t})\r\n}\r\n\r\nconst loginValid = () => {\r\n\treturn axios.get(\"/isloggedin\", { headers: authHeader() })\r\n}\r\n\r\nexport default {\r\n\tregister,\r\n\tlogin,\r\n\tlogout,\r\n\tuserUpdate,\r\n\tloginValid\r\n};"]},"metadata":{},"sourceType":"module"}